<!DOCTYPE html>
<html lang="ru">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pixel Platformer: Industrial Expansion</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background-color: #1a1a2e;
                color: #e6e6e6;
                font-family: "Courier New", monospace;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 20px;
            }

            .game-container {
                position: relative;
                width: 800px;
                max-width: 100%;
                margin-bottom: 20px;
            }

            canvas {
                display: block;
                background-color: #162447;
                border: 4px solid #0f3460;
                border-radius: 8px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                image-rendering: pixelated;
            }

            .ui-container {
                display: flex;
                justify-content: space-between;
                width: 800px;
                max-width: 100%;
                margin-bottom: 15px;
            }

            .controls {
                display: flex;
                flex-direction: column;
                gap: 10px;
                background-color: #0f3460;
                padding: 15px;
                border-radius: 8px;
                border: 2px solid #e94560;
            }

            .controls h3 {
                color: #e94560;
                margin-bottom: 5px;
                text-align: center;
            }

            .stats {
                display: flex;
                flex-direction: column;
                gap: 10px;
                background-color: #0f3460;
                padding: 15px;
                border-radius: 8px;
                border: 2px solid #e94560;
            }

            .stats h3 {
                color: #e94560;
                margin-bottom: 5px;
                text-align: center;
            }

            .stat {
                display: flex;
                justify-content: space-between;
            }

            .buttons {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            button {
                background-color: #e94560;
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 4px;
                cursor: pointer;
                font-family: "Courier New", monospace;
                font-weight: bold;
                transition: background-color 0.3s;
            }

            button:hover {
                background-color: #ff6b81;
            }

            .game-title {
                font-size: 28px;
                color: #e94560;
                text-shadow: 2px 2px 0 #000;
                margin-bottom: 15px;
                text-align: center;
            }

            .instructions {
                background-color: #0f3460;
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                border: 2px solid #e94560;
                max-width: 800px;
            }

            .instructions h3 {
                color: #e94560;
                margin-bottom: 10px;
                text-align: center;
            }

            .instructions ul {
                list-style-type: none;
                padding-left: 10px;
            }

            .instructions li {
                margin-bottom: 8px;
                display: flex;
                align-items: center;
            }

            .key {
                display: inline-block;
                background-color: #1a1a2e;
                border: 1px solid #e94560;
                border-radius: 4px;
                padding: 2px 6px;
                margin: 0 5px;
                font-weight: bold;
            }

            .screen {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background-color: rgba(15, 52, 96, 0.9);
                border-radius: 8px;
                z-index: 10;
            }

            .screen h2 {
                font-size: 36px;
                color: #e94560;
                margin-bottom: 20px;
                text-shadow: 2px 2px 0 #000;
            }

            .screen p {
                font-size: 18px;
                margin-bottom: 20px;
                text-align: center;
                max-width: 80%;
            }

            .hidden {
                display: none;
            }

            .credits {
                margin-top: 20px;
                text-align: center;
                font-size: 14px;
                color: #8a8a8a;
            }

            .credits a {
                color: #e94560;
                text-decoration: none;
            }

            .credits a:hover {
                text-decoration: underline;
            }
        </style>
    </head>

    <body>
        <h1 class="game-title">Pixel Platformer Industrial Expansion (1.0)</h1>

        <div class="ui-container">
            <div class="controls">
                <h3>Управление</h3>
                <div class="stat">
                    <span>Движение:</span>
                    <span>← →</span>
                </div>
                <div class="stat">
                    <span>Прыжок:</span>
                    <span>Пробел / ↑</span>
                </div>
                <div class="stat">
                    <span>Перезапуск:</span>
                    <span>R</span>
                </div>
            </div>

            <div class="stats">
                <h3>Статистика</h3>
                <div class="stat">
                    <span>Уровень:</span>
                    <span id="level">1</span>
                </div>
                <div class="stat">
                    <span>Жизни:</span>
                    <span id="lives">3</span>
                </div>
                <div class="stat">
                    <span>Очки:</span>
                    <span id="score">0</span>
                </div>
                <div class="stat">
                    <span>Шестерёнки:</span>
                    <span id="gears">0</span>
                </div>
            </div>
        </div>

        <div class="game-container">
            <canvas id="gameCanvas" width="800" height="450"></canvas>

            <div id="startScreen" class="screen">
                <h2>Pixel Platformer</h2>
                <p>Помоги инженеру собрать все шестерёнки на заброшенной фабрике!</p>
                <p>
                    Избегай опасных механизмов и достигни выхода, чтобы перейти на
                    следующий уровень.
                </p>
                <button id="startButton">Начать игру</button>
            </div>

            <div id="gameOverScreen" class="screen hidden">
                <h2>Игра окончена</h2>
                <p>Вы набрали <span id="finalScore">0</span> очков</p>
                <button id="restartButton">Играть снова</button>
            </div>

            <div id="levelCompleteScreen" class="screen hidden">
                <h2>Уровень пройден!</h2>
                <p>Поздравляем! Вы собрали все шестерёнки.</p>
                <button id="nextLevelButton">Следующий уровень</button>
            </div>
        </div>

        <div class="instructions">
            <h3>Как играть</h3>
            <ul>
                <li>
                    <span class="key">←</span> <span class="key">→</span> - Двигаться
                    влево/вправо
                </li>
                <li>
                    <span class="key">Пробел</span> или <span class="key">↑</span> -
                    Прыжок
                </li>
                <li>Собирайте шестерёнки для получения очков</li>
                <li>Избегайте контакта с вращающимися механизмами</li>
                <li>Достигните выхода, чтобы завершить уровень</li>
            </ul>
        </div>

        <div class="credits">
            <p>
                Игра создана в образовательных целях. Графика сгенерирована программой.
            </p>
        </div>

        <script>
            // Инициализация игры
            const canvas = document.getElementById("gameCanvas");
            const ctx = canvas.getContext("2d");

            // Элементы интерфейса
            const startScreen = document.getElementById("startScreen");
            const gameOverScreen = document.getElementById("gameOverScreen");
            const levelCompleteScreen = document.getElementById(
                "levelCompleteScreen"
            );
            const startButton = document.getElementById("startButton");
            const restartButton = document.getElementById("restartButton");
            const nextLevelButton = document.getElementById("nextLevelButton");
            const levelDisplay = document.getElementById("level");
            const livesDisplay = document.getElementById("lives");
            const scoreDisplay = document.getElementById("score");
            const gearsDisplay = document.getElementById("gears");
            const finalScoreDisplay = document.getElementById("finalScore");

            // Игровые переменные
            let gameState = "start"; // start, playing, gameOver, levelComplete
            let level = 1;
            let lives = 3;
            let score = 0;
            let gearsCollected = 0;
            let totalGears = 0;

            // Игровые объекты
            let player = {
                x: 50,
                y: 300,
                width: 24,
                height: 32,
                velocityX: 0,
                velocityY: 0,
                speed: 5,
                jumpPower: 12,
                isJumping: false,
                color: "#e94560",
            };

            let platforms = [];
            let gears = [];
            let hazards = [];
            let exit = null;

            // Гравитация
            const gravity = 0.5;

            // Клавиши управления
            const keys = {
                right: false,
                left: false,
                up: false,
            };

            // Инициализация уровня
            function initLevel() {
                platforms = [];
                gears = [];
                hazards = [];
                gearsCollected = 0;

                // Создание платформ в зависимости от уровня
                if (level === 1) {
                    // Платформы для уровня 1
                    platforms = [
                        { x: 0, y: 400, width: 200, height: 20, color: "#555" },
                        { x: 250, y: 350, width: 150, height: 20, color: "#555" },
                        { x: 450, y: 300, width: 150, height: 20, color: "#555" },
                        { x: 650, y: 250, width: 150, height: 20, color: "#555" },
                        { x: 500, y: 200, width: 100, height: 20, color: "#555" },
                        { x: 300, y: 200, width: 100, height: 20, color: "#555" },
                        { x: 100, y: 250, width: 100, height: 20, color: "#555" },
                    ];

                    // Шестерёнки для уровня 1
                    gears = [
                        { x: 100, y: 220, radius: 12, color: "#ffcc00", collected: false },
                        { x: 320, y: 170, radius: 12, color: "#ffcc00", collected: false },
                        { x: 520, y: 170, radius: 12, color: "#ffcc00", collected: false },
                        { x: 700, y: 220, radius: 12, color: "#ffcc00", collected: false },
                    ];

                    // Опасности для уровня 1
                    hazards = [
                        {
                            x: 400,
                            y: 380,
                            width: 40,
                            height: 20,
                            color: "#ff0000",
                            type: "saw",
                        },
                        {
                            x: 600,
                            y: 330,
                            width: 40,
                            height: 20,
                            color: "#ff0000",
                            type: "saw",
                        },
                    ];

                    // Выход
                    exit = { x: 750, y: 200, width: 30, height: 50, color: "#00ff00" };
                } else if (level === 2) {
                    // Платформы для уровня 2
                    platforms = [
                        { x: 0, y: 400, width: 150, height: 20, color: "#555" },
                        { x: 200, y: 380, width: 100, height: 20, color: "#555" },
                        { x: 350, y: 350, width: 100, height: 20, color: "#555" },
                        { x: 500, y: 320, width: 100, height: 20, color: "#555" },
                        { x: 650, y: 290, width: 150, height: 20, color: "#555" },
                        { x: 550, y: 220, width: 100, height: 20, color: "#555" },
                        { x: 350, y: 190, width: 100, height: 20, color: "#555" },
                        { x: 150, y: 160, width: 100, height: 20, color: "#555" },
                    ];

                    // Шестерёнки для уровня 2
                    gears = [
                        { x: 240, y: 350, radius: 12, color: "#ffcc00", collected: false },
                        { x: 400, y: 320, radius: 12, color: "#ffcc00", collected: false },
                        { x: 600, y: 290, radius: 12, color: "#ffcc00", collected: false },
                        { x: 590, y: 190, radius: 12, color: "#ffcc00", collected: false },
                        { x: 190, y: 130, radius: 12, color: "#ffcc00", collected: false },
                    ];

                    // Опасности для уровня 2
                    hazards = [
                        {
                            x: 300,
                            y: 360,
                            width: 40,
                            height: 20,
                            color: "#ff0000",
                            type: "saw",
                        },
                        {
                            x: 450,
                            y: 310,
                            width: 40,
                            height: 20,
                            color: "#ff0000",
                            type: "saw",
                        },
                        {
                            x: 700,
                            y: 270,
                            width: 40,
                            height: 20,
                            color: "#ff0000",
                            type: "saw",
                        },
                    ];

                    // Выход
                    exit = { x: 50, y: 120, width: 30, height: 50, color: "#00ff00" };
                }

                // Начальная позиция игрока
                player.x = 50;
                player.y = 300;
                player.velocityX = 0;
                player.velocityY = 0;
                player.isJumping = false;

                totalGears = gears.length;
                updateUI();
            }

            // Обновление интерфейса
            function updateUI() {
                levelDisplay.textContent = level;
                livesDisplay.textContent = lives;
                scoreDisplay.textContent = score;
                gearsDisplay.textContent = `${gearsCollected}/${totalGears}`;
            }

            // Обработка ввода
            document.addEventListener("keydown", (e) => {
                if (e.key === "ArrowRight" || e.key === "d") keys.right = true;
                if (e.key === "ArrowLeft" || e.key === "a") keys.left = true;
                if (
                    (e.key === "ArrowUp" || e.key === "w" || e.key === " ") &&
                    !player.isJumping
                ) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                }
                if (e.key === "r") resetGame();
            });

            document.addEventListener("keyup", (e) => {
                if (e.key === "ArrowRight" || e.key === "d") keys.right = false;
                if (e.key === "ArrowLeft" || e.key === "a") keys.left = false;
            });

            // Движение игрока
            function movePlayer() {
                // Горизонтальное движение
                if (keys.right) {
                    player.velocityX = player.speed;
                } else if (keys.left) {
                    player.velocityX = -player.speed;
                } else {
                    player.velocityX = 0;
                }

                // Применение гравитации
                player.velocityY += gravity;

                // Обновление позиции
                player.x += player.velocityX;
                player.y += player.velocityY;

                // Ограничение в пределах экрана
                if (player.x < 0) player.x = 0;
                if (player.x + player.width > canvas.width)
                    player.x = canvas.width - player.width;
                if (player.y > canvas.height) {
                    playerDie();
                }

                // Проверка столкновений с платформами
                player.isJumping = true;
                for (let platform of platforms) {
                    if (
                        player.x < platform.x + platform.width &&
                        player.x + player.width > platform.x &&
                        player.y + player.height > platform.y &&
                        player.y + player.height < platform.y + platform.height &&
                        player.velocityY > 0
                    ) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.isJumping = false;
                    }
                }

                // Проверка столкновений с шестерёнками
                for (let gear of gears) {
                    if (
                        !gear.collected &&
                        player.x < gear.x + gear.radius &&
                        player.x + player.width > gear.x - gear.radius &&
                        player.y < gear.y + gear.radius &&
                        player.y + player.height > gear.y - gear.radius
                    ) {
                        gear.collected = true;
                        gearsCollected++;
                        score += 100;
                        updateUI();
                    }
                }

                // Проверка столкновений с опасностями
                for (let hazard of hazards) {
                    if (
                        player.x < hazard.x + hazard.width &&
                        player.x + player.width > hazard.x &&
                        player.y < hazard.y + hazard.height &&
                        player.y + player.height > hazard.y
                    ) {
                        playerDie();
                    }
                }

                // Проверка достижения выхода
                if (
                    exit &&
                    player.x < exit.x + exit.width &&
                    player.x + player.width > exit.x &&
                    player.y < exit.y + exit.height &&
                    player.y + player.height > exit.y
                ) {
                    if (gearsCollected === totalGears) {
                        levelComplete();
                    }
                }
            }

            // Смерть игрока
            function playerDie() {
                lives--;
                updateUI();

                if (lives <= 0) {
                    gameOver();
                } else {
                    // Перезапуск уровня
                    player.x = 50;
                    player.y = 300;
                    player.velocityX = 0;
                    player.velocityY = 0;
                    player.isJumping = false;

                    // Сброс собранных шестерёнок
                    gearsCollected = 0;
                    for (let gear of gears) {
                        gear.collected = false;
                    }
                    updateUI();
                }
            }

            // Отрисовка игры
            function draw() {
                // Очистка экрана
                ctx.fillStyle = "#162447";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Отрисовка фона (индустриальные элементы)
                drawBackground();

                // Отрисовка платформ
                for (let platform of platforms) {
                    ctx.fillStyle = platform.color;
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

                    // Текстура платформ
                    ctx.fillStyle = "#333";
                    for (let i = 0; i < platform.width; i += 10) {
                        ctx.fillRect(platform.x + i, platform.y, 5, 3);
                    }
                }

                // Отрисовка опасностей
                for (let hazard of hazards) {
                    ctx.fillStyle = hazard.color;
                    if (hazard.type === "saw") {
                        // Пила
                        ctx.beginPath();
                        ctx.arc(
                            hazard.x + hazard.width / 2,
                            hazard.y + hazard.height / 2,
                            hazard.width / 2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();

                        // Зубья пилы
                        ctx.fillStyle = "#333";
                        for (let i = 0; i < 8; i++) {
                            const angle = (i / 8) * Math.PI * 2;
                            const x1 =
                                hazard.x +
                                hazard.width / 2 +
                                Math.cos(angle) * (hazard.width / 2 - 2);
                            const y1 =
                                hazard.y +
                                hazard.height / 2 +
                                Math.sin(angle) * (hazard.width / 2 - 2);
                            const x2 =
                                hazard.x +
                                hazard.width / 2 +
                                Math.cos(angle) * (hazard.width / 2 + 5);
                            const y2 =
                                hazard.y +
                                hazard.height / 2 +
                                Math.sin(angle) * (hazard.width / 2 + 5);

                            ctx.beginPath();
                            ctx.moveTo(
                                hazard.x + hazard.width / 2,
                                hazard.y + hazard.height / 2
                            );
                            ctx.lineTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.closePath();
                            ctx.fill();
                        }
                    } else {
                        ctx.fillRect(hazard.x, hazard.y, hazard.width, hazard.height);
                    }
                }

                // Отрисовка шестерёнок
                for (let gear of gears) {
                    if (!gear.collected) {
                        ctx.fillStyle = gear.color;
                        ctx.beginPath();
                        ctx.arc(gear.x, gear.y, gear.radius, 0, Math.PI * 2);
                        ctx.fill();

                        // Зубья шестерёнки
                        ctx.fillStyle = "#cc9900";
                        for (let i = 0; i < 8; i++) {
                            const angle = (i / 8) * Math.PI * 2;
                            const x1 = gear.x + Math.cos(angle) * (gear.radius - 3);
                            const y1 = gear.y + Math.sin(angle) * (gear.radius - 3);
                            const x2 = gear.x + Math.cos(angle) * (gear.radius + 3);
                            const y2 = gear.y + Math.sin(angle) * (gear.radius + 3);
                            const nextAngle = ((i + 0.5) / 8) * Math.PI * 2;
                            const x3 = gear.x + Math.cos(nextAngle) * (gear.radius - 3);
                            const y3 = gear.y + Math.sin(nextAngle) * (gear.radius - 3);

                            ctx.beginPath();
                            ctx.moveTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.lineTo(x3, y3);
                            ctx.closePath();
                            ctx.fill();
                        }

                        // Центр шестерёнки
                        ctx.fillStyle = "#996600";
                        ctx.beginPath();
                        ctx.arc(gear.x, gear.y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                // Отрисовка выхода
                if (exit) {
                    ctx.fillStyle = exit.color;
                    ctx.fillRect(exit.x, exit.y, exit.width, exit.height);

                    // Дверная ручка
                    ctx.fillStyle = "#ccffcc";
                    ctx.beginPath();
                    ctx.arc(
                        exit.x + exit.width - 10,
                        exit.y + exit.height / 2,
                        4,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                }

                // Отрисовка игрока
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);

                // Детали игрока
                ctx.fillStyle = "#b33451";
                // Голова
                ctx.fillRect(player.x + 5, player.y + 5, player.width - 10, 10);
                // Глаза
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(player.x + 8, player.y + 8, 3, 3);
                ctx.fillRect(player.x + player.width - 11, player.y + 8, 3, 3);
            }

            // Отрисовка фона с индустриальными элементами
            function drawBackground() {
                // Трубы
                ctx.fillStyle = "#666";
                ctx.fillRect(100, 100, 200, 20);
                ctx.fillRect(300, 100, 20, 150);
                ctx.fillRect(500, 150, 150, 20);
                ctx.fillRect(650, 150, 20, 100);

                // Окна
                ctx.fillStyle = "#4a9de3";
                for (let i = 0; i < 5; i++) {
                    ctx.fillRect(50 + i * 60, 50, 40, 60);
                }

                // Болты на стенах
                ctx.fillStyle = "#999";
                for (let i = 0; i < canvas.width; i += 40) {
                    for (let j = 0; j < canvas.height; j += 40) {
                        ctx.beginPath();
                        ctx.arc(i, j, 2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            // Игровой цикл
            function gameLoop() {
                if (gameState === "playing") {
                    movePlayer();
                    draw();
                }
                requestAnimationFrame(gameLoop);
            }

            // Начало игры
            function startGame() {
                gameState = "playing";
                startScreen.classList.add("hidden");
                initLevel();
            }

            // Завершение уровня
            function levelComplete() {
                gameState = "levelComplete";
                levelCompleteScreen.classList.remove("hidden");
                score += 500; // Бонус за завершение уровня
                updateUI();
            }

            // Конец игры
            function gameOver() {
                gameState = "gameOver";
                finalScoreDisplay.textContent = score;
                gameOverScreen.classList.remove("hidden");
            }

            // Перезапуск игры
            function resetGame() {
                gameState = "playing";
                level = 1;
                lives = 3;
                score = 0;
                gearsCollected = 0;
                gameOverScreen.classList.add("hidden");
                levelCompleteScreen.classList.add("hidden");
                initLevel();
            }

            // Переход на следующий уровень
            function nextLevel() {
                level++;
                gameState = "playing";
                levelCompleteScreen.classList.add("hidden");
                initLevel();
            }

            // Обработчики событий кнопок
            startButton.addEventListener("click", startGame);
            restartButton.addEventListener("click", resetGame);
            nextLevelButton.addEventListener("click", nextLevel);

            // Запуск игрового цикла
            gameLoop();

            // Обновление интерфейса при загрузке
            updateUI();
        </script>
    </body>

</html>